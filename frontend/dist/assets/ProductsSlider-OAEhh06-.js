import{r as i,a as y,j as s,b as N,k as E,l as v,m as k,B as c,n as C}from"./index-DFFnt1R-.js";const F=()=>{const[d,u]=i.useState([]),[p,l]=i.useState({}),f=y(),[g,w]=i.useState(d.reduce((t,r)=>(t[r.id]=r.rating,t),{})),j=(t,r)=>{w(e=>({...e,[t]:r}))};i.useEffect(()=>{const t=async()=>{try{const e=await fetch(`${c}/product/latest`);if(!e.ok)throw new Error("Failed to fetch products");const n=(await e.json())["All products"];u(n),console.log(d)}catch(e){console.log("Error fetching products",e)}},r=async()=>{try{const e=await fetch(`${c}/cart`,{method:"GET",credentials:"include"});if(!e.ok)throw new Error("Failed to fetch cart");const n=(await e.json()).items.reduce((o,h)=>(o[h.product._id]=h.quantity,o),{});l(n)}catch(e){console.log("Error fetching cart",e)}};t(),r()},[]);const m=async(t,r)=>{if(!localStorage.getItem("userInfo")){C.warning("Login to add product to cart"),f("/login");return}try{const a=await fetch(`${c}/cart`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({productId:t,quantity:1})});if(!a.ok)throw new Error("Failed to add product to cart");const n=await a.json();l(o=>({...o,[t]:(o[t]||0)+r}))}catch(a){console.log("Error adding product to cart",a)}},b=async t=>{try{const r=x(t);if(l(e=>({...e,[t]:r>1?r-1:0})),r>1){if(!(await fetch(`${c}/cart`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({productId:t,quantity:-1})})).ok)throw new Error("Failed to remove product from cart")}else{if(!(await fetch(`${c}/cart/${t}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to remove product from cart");l(a=>{const{[t]:n,...o}=a;return o})}}catch(r){console.log("Error removing product from cart",r)}},x=t=>p[t]||0;return s.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:s.jsx("div",{className:"flex gap-4",children:d.map(t=>s.jsxs("div",{className:"card flex-shrink-0 bg-white shadow-lg gap-3 rounded-lg w-[150px] sm:w-[45%] md:w-[300px] md:h[500px]",children:[s.jsxs("div",{className:"bg-gray-100 flex flex-col gap-2 p-2 w-full items-center",children:[s.jsxs("div",{className:"flex flex-col gap-1 self-start",children:[s.jsx("p",{className:"bg-white px-2 font-semibold text-xs sm:text-sm",children:"NEW"}),s.jsx("p",{className:"bg-green-400 px-2 text-white font-semibold text-xs sm:text-sm",children:"-50%"})]}),s.jsx(N,{to:`/product/${t._id}`,children:s.jsx("img",{src:t.images[0],alt:t.name,className:"w-[300px] md:w-[320px] h-[130px] sm:h-[150px] md:h-[230px] md:p-2 object-cover rounded-md"})}),x(t._id)>0?s.jsxs("div",{className:"flex items-center justify-between mt-2 button",children:[s.jsx("button",{className:"text-xs sm:text-sm",onClick:()=>b(t._id),children:s.jsx(E,{})}),s.jsx("span",{className:"text-xs sm:text-sm mx-2",children:x(t._id)}),s.jsx("button",{className:"text-xs sm:text-sm",onClick:()=>m(t._id,1),children:s.jsx(v,{})})]}):s.jsx("button",{className:"button text-xs sm:text-sm mt-2",onClick:()=>m(t._id,1),children:"Add to Cart"})]}),s.jsxs("div",{className:"flex flex-col items-start p-4 pb-8",children:[s.jsx("div",{className:"flex gap-1 mb-1",children:Array.from({length:5},(r,e)=>s.jsx(k,{color:e<g[t._id]?"#FFD700":"#E0E0E0",className:"cursor-pointer",onClick:()=>j(t._id,e+1)},e))}),s.jsx("p",{className:"text-xs sm:text-base font-semibold",children:t.name}),s.jsxs("p",{className:"text-xs sm:text-sm font-semibold mt-1",children:["â‚¹ ",t.price]})]})]},t._id))})})};export{F as P};
