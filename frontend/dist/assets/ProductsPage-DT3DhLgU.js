import{r as i,a as N,j as t,b as y,k as E,l as v,m as C,B as d,n as k}from"./index-DFFnt1R-.js";import{b as _}from"./productsBanner-8bCIN-6B.js";const F=()=>{const[f,p]=i.useState([]),[g,w]=i.useState({}),[x,l]=i.useState({}),j=N();i.useEffect(()=>{const e=async()=>{try{const s=await fetch(`${d}/product`);if(!s.ok)throw new Error("Failed to fetch products");const n=(await s.json())["All products"];p(n);const a=n.reduce((c,h)=>(c[h._id]=h.rating,c),{});w(a)}catch(s){console.log("Error fetching products",s)}},o=async()=>{try{const s=await fetch(`${d}/cart`,{method:"GET",credentials:"include"});if(!s.ok)throw new Error("Failed to fetch cart");const n=(await s.json()).items.reduce((a,c)=>(a[c.product._id]=c.quantity,a),{});l(n)}catch(s){console.log("Error fetching cart",s)}};e(),o()},[]),i.useEffect(()=>{console.log("Cart state updated:",x)},[x]);const u=async(e,o=1)=>{if(!localStorage.getItem("userInfo")){k.warning("Login to add product to cart"),j("/login");return}try{const r=await fetch(`${d}/cart`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({productId:e,quantity:o})});if(!r.ok)throw new Error("Failed to add product to cart");const n=await r.json();l(a=>({...a,[e]:(a[e]||0)+o}))}catch(r){console.log("Error adding product to cart",r)}},b=async e=>{try{const o=m(e);if(l(s=>({...s,[e]:o>1?o-1:0})),o>1){const s=await fetch(`${d}/cart`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({productId:e,quantity:-1})});if(!s.ok)throw new Error("Failed to decrease product quantity");const r=await s.json();if(!r||!r.items){console.error("Cart update response is invalid");return}const n=r.items.reduce((a,c)=>(a[c.product._id]=c.quantity,a),{});l(n)}else{if(!(await fetch(`${d}/cart/${e}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to remove product from cart");l(r=>{const{[e]:n,...a}=r;return a})}}catch(o){console.error("Error removing product from cart",o)}},m=e=>x[e]||0;return t.jsx("div",{className:"py-10 w-full flex flex-col items-center",children:t.jsx("div",{className:"flex flex-wrap items-center justify-center gap-4",children:f.map(e=>t.jsxs("div",{className:"bg-white shadow-sm rounded-lg w-[150px] sm:w-[45%] md:w-[300px] lg:w-[220px] flex-shrink-0 flex flex-col p-4",children:[t.jsxs("div",{className:"bg-gray-100 flex flex-col gap-2 p-3 w-full",children:[t.jsxs("div",{className:"flex flex-col gap-1 self-start",children:[t.jsx("p",{className:"bg-white px-2 font-semibold text-xs sm:text-sm",children:"NEW"}),t.jsx("p",{className:"bg-green-400 px-2 text-white font-semibold text-xs sm:text-sm",children:"-50%"})]}),t.jsx(y,{to:`/product/${e._id}`,children:t.jsx("img",{src:e.images[0],alt:e.name,className:"w-full h-[100px] sm:h-[150px] object-cover rounded-md"})}),m(e._id)>0?t.jsxs("div",{className:"flex items-center justify-between mt-2 button",children:[t.jsx("button",{className:"text-xs sm:text-sm",onClick:()=>b(e._id),children:t.jsx(E,{})}),t.jsx("span",{className:"text-xs sm:text-sm mx-2",children:m(e._id)}),t.jsx("button",{className:"text-xs sm:text-sm",onClick:()=>u(e._id,1),children:t.jsx(v,{})})]}):t.jsx("button",{className:"button text-xs sm:text-sm mt-2",onClick:()=>u(e._id,1),children:"Add to Cart"})]}),t.jsxs("div",{className:"flex flex-col p-4",children:[t.jsx("div",{className:"flex gap-1 mb-1",children:Array.from({length:5},(o,s)=>t.jsx(C,{color:s<g[e._id]?"#FFD700":"#E0E0E0",className:"cursor-pointer",onClick:()=>handleRatingClick(e._id,s+1)},s))}),t.jsx("p",{className:"text-xs sm:text-base font-semibold",children:e.name}),t.jsxs("p",{className:"text-xs sm:text-sm font-semibold mt-1",children:["â‚¹ ",e.price]})]})]},e._id))})})},R=()=>t.jsxs("div",{children:[t.jsxs("div",{className:"w-full h-[150px] md:h-[400px] sm:h-[300px] relative",children:[t.jsx("img",{src:_,alt:"banner",className:"w-full h-full object-cover"}),t.jsxs("div",{className:"flex flex-col p-4 gap-2 items-center bg-black bg-opacity-50 w-[40%] sm:w-[90%] md:w-[70%] h-[30%] sm:h-[40%] justify-center absolute top-0 bottom-0 left-0 right-0 m-auto",children:[t.jsx("h1",{className:"text-sm md:text-3xl sm:text-2xl text-white font-medium",children:"Products Page"}),t.jsx("p",{className:"text-white text-center hidden md:block md:text-base sm:text-sm",children:"Find the best products"})]})]}),t.jsx(F,{})]});export{R as default};
